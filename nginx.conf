server {
  # Lytt på HTTP port 80.
  listen 80;

  # "_" betyr "match alt" (ingen spesifikk host). Helt greit i en ren
  # container-setting / internt oppsett.
  server_name _;

  # Maks størrelse på HTTP body (f.eks. JSON, små filer) internt i Nginx
  client_max_body_size 10m;

  # Rotmappe for statiske filer (index.html, JS, CSS).
  root /usr/share/nginx/html;
  index index.html;

  # Sikkerhets-headere for statisk innhold.
  add_header X-Content-Type-Options "nosniff" always;

  # Sender kun med referer ved "ikke-oppover-downgrade"
  add_header Referrer-Policy "no-referrer-when-downgrade" always;

  # Hindrer siden i å bli innrammet på andre domener.
  add_header X-Frame-Options "SAMEORIGIN" always;

  # Permissions-Policy.
  # Her tillater du:
  #   - mikrofon på dette domenet (mic=*)
  #   - skjermdeling (display-capture=*)
  #   - blokkerer kamera fullstendig (camera=())
  #   - blokkerer geolokasjon (geolocation=())
  add_header Permissions-Policy "microphone=*, display-capture=*, camera=(), geolocation=()" always;

  # Hoved-frontend. Forsøker å serve faktisk fil/sti,
  # og faller ellers tilbake til index.html.
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Reverse proxy for API-kall.
  # Alle kall til /api/... sendes videre til Node-serveren.
  location /api/ {
    # Viktig: sørger for at /api/ → /api/ på backend.
    proxy_pass http://server:3001/api/;

    # HTTP/1.1 er standard i nyere nginx, men det er greit å være eksplisitt.
    proxy_http_version 1.1;

    # Sender opprinnelig Host-header videre (så backend ser riktig hostnavn).
    proxy_set_header Host $host;

    # Sier til backend om dette var http/https
    proxy_set_header X-Forwarded-Proto http;

    # Beholder “innkommende klient-IP” gjennom proxylaget.
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
}
